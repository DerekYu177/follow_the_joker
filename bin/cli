#!/usr/bin/env ruby

require 'follow_the_joker/cli'
require 'follow_the_joker/version'
require 'cli'

settings = CLI.new do
  description 'Run Follow the Joker game via CLI'
  version FollowTheJoker::VERSION

  option(
    :shuffle_seed,
    short: :s,
    default: -1,
    cast: Integer,
    description: "Sets the value for Random.new() used for shuffling the deck",
  )
  option(
    :number_of_users,
    short: :n,
    default: 6,
    cast: Integer,
    description: "Sets the number of users. Must be an even number. Minimum 2."
  )
end.parse! do |settings|
  unless settings.number_of_users.even? && settings.number_of_users >= 2
    fail "Number of users must be an even number >= 2"
  end
end

settings.shuffle_seed = nil if settings.shuffle_seed < 0

loop { ARGV.any? ? ARGV.pop : break } # breaks CLI
FollowTheJoker::Cli.new(**settings.to_h).start!
